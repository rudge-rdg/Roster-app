<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chargers C Team - Rotation Tracker</title>
    <style>
        :root { 
            --primary: #ff6d00; 
            --bg: #000000; 
            --card: #1a1a1a; 
            --text: #ffffff; 
            --pending: #2979ff; 
            --confirm: #4caf50; 
            --error: #d32f2f; 
            --bench: #9e9e9e; 
            --navy: #002b5c; 
            --muted-yellow: #a68a00; 
            --safe: #2e7d32;
        }
        
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden; 
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        /* Navigation Tabs - Larger for thumbs */
        .tabs { display: flex; background: #111; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 200; }
        .tab { flex: 1; padding: 16px 5px; text-align: center; font-weight: bold; color: #888; cursor: pointer; border-bottom: 4px solid transparent; font-size: 0.8em; transition: all 0.2s; }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); background: #1a1a1a; }

        .container { padding: 10px; padding-bottom: 160px; max-width: 600px; margin: 0 auto; }
        .hidden { display: none !important; }

        /* Timer UI */
        .shift-timer-box { background: #222; border: 1px solid #333; border-radius: 12px; padding: 12px; margin-bottom: 10px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .total-game-time { font-size: 0.8em; color: #aaa; font-weight: bold; margin-bottom: 4px; display: block; letter-spacing: 0.05em; }
        
        .shift-display { display: flex; align-items: center; justify-content: center; gap: 12px; line-height: 1; margin-bottom: 8px; }
        .timer-label { font-size: 0.9em; color: #888; font-weight: bold; text-transform: uppercase; }
        .shift-clock { font-family: 'Courier New', Courier, monospace; font-size: 2.8em; font-weight: bold; color: var(--text); }
        .shift-clock.expired { color: var(--error); animation: blink 1s infinite; }
        
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        
        .timer-controls { display: flex; justify-content: center; gap: 10px; align-items: center; }
        .timer-btn { background: #444; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; font-size: 0.9em; active { transform: scale(0.95); } }
        .time-input { background: #000; color: var(--primary); border: 1px solid #444; width: 45px; text-align: center; font-weight: bold; font-size: 1.2em; border-radius: 6px; padding: 4px; }

        /* Section Headers */
        .section-header { font-weight: bold; font-size: 0.85em; padding: 10px; border-radius: 6px; margin: 12px 0 6px; display: flex; justify-content: center; align-items: center; gap: 10px; text-transform: uppercase; letter-spacing: 0.1em; }
        .header-court { background: var(--navy); color: #fff; border: 1px solid rgba(255,255,255,0.1); }
        .header-bench { background: var(--muted-yellow); color: #fff; border: 1px solid rgba(255,255,255,0.1); }

        /* Grid for Cards */
        .player-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        
        /* Optimized Player Card */
        .player-card { 
            background: var(--card); 
            border: 1px solid #333; 
            border-radius: 10px; 
            padding: 8px 4px; 
            text-align: center; 
            min-height: 90px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: space-between; 
            transition: transform 0.1s;
            position: relative;
        }
        .player-card:active { transform: scale(0.96); }
        .player-card.active { border: 2px solid var(--primary); background: #261a00; }
        .player-card.pending-change { border: 2px solid var(--pending); box-shadow: 0 0 12px rgba(41, 121, 255, 0.4); }
        
        /* "Who should go in next" indicator */
        .next-up-indicator { position: absolute; top: 4px; left: 4px; width: 8px; height: 8px; background: #4caf50; border-radius: 50%; box-shadow: 0 0 5px #4caf50; }

        .name { font-weight: bold; font-size: 1.1em; color: #fff; margin-bottom: 2px; width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .time { font-family: monospace; font-size: 0.95em; color: var(--primary); font-weight: bold; }
        .bench-timer { font-size: 0.65em; color: var(--bench); font-family: monospace; font-weight: bold; }
        
        .shift-badge { background: #333; color: #fff; font-size: 0.8em; font-weight: 800; padding: 3px 0; border-radius: 6px; margin-top: 4px; border: 1px solid #555; width: 90%; text-align: center; }
        .has-played { border-color: var(--primary); color: var(--primary); }

        /* Roster Toggle Card */
        .roster-card { background: var(--card); border: 1px solid #333; border-radius: 12px; padding: 15px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .roster-card.present { border-left: 6px solid var(--confirm); }
        .roster-card.absent { opacity: 0.3; border-left: 6px solid #444; }

        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--confirm); }
        input:checked + .slider:before { transform: translateX(22px); }

        /* Bottom Controls */
        .controls { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(17, 17, 17, 0.95); backdrop-filter: blur(10px); padding: 15px; border-top: 1px solid #333; display: flex; flex-direction: column; gap: 10px; z-index: 100; }
        .btn-row { display: flex; gap: 10px; }
        button { flex: 1; padding: 18px; border: none; border-radius: 12px; font-weight: bold; font-size: 1em; -webkit-appearance: none; }
        .btn-confirm { background: var(--confirm); color: white; display: none; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); }
        .btn-start-game { background: var(--confirm); color: white; display: block; }
        .btn-start-game:disabled { background: #333; color: #666; }
        .btn-secondary { background: #2a2a2a; color: white; }
        
        .status-msg { font-size: 0.9em; text-align: center; min-height: 1.2em; font-weight: 500; }
        .text-ok { color: var(--confirm); }
        .text-error { color: var(--error); font-weight: bold; }

        /* Toast Notification */
        #toast { 
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); 
            background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; 
            border-radius: 20px; font-size: 0.9em; z-index: 1000; opacity: 0; 
            transition: opacity 0.3s; pointer-events: none; border: 1px solid var(--primary);
        }

        /* Help Items */
        .help-item { margin-bottom: 15px; background: #1a1a1a; padding: 15px; border-radius: 12px; border: 1px solid #333; }
        .help-title { color: var(--primary); font-weight: bold; display: block; font-size: 1em; border-bottom: 1px solid #333; padding-bottom: 6px; margin-bottom: 10px; }
        .help-text { font-size: 0.9em; color: #ccc; line-height: 1.5; }
        .legend-row { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; font-size: 0.9em; }
        .swatch { width: 24px; height: 24px; border-radius: 6px; border: 1px solid #444; flex-shrink: 0; }
    </style>
</head>
<body>

    <div id="toast">Message here</div>

    <div class="tabs">
        <div id="tab-roster" class="tab active" onclick="switchTab('roster')">CHECK-IN</div>
        <div id="tab-game" class="tab" onclick="switchTab('game')">GAME</div>
        <div id="tab-summary" class="tab" onclick="switchTab('summary')">STATS</div>
        <div id="tab-help" class="tab" onclick="switchTab('help')">HELP</div>
    </div>

    <!-- ROSTER VIEW -->
    <div id="view-roster" class="container">
        <h3 style="color:var(--primary); margin:10px 0; text-align:center;">Who's playing today?</h3>
        <div id="roster-check-list"></div>
    </div>

    <!-- GAME VIEW -->
    <div id="view-game" class="container hidden">
        <div id="game-active-timer" class="hidden">
            <div class="shift-timer-box">
                <span id="total-game-clock" class="total-game-time">TOTAL: 00:00</span>
                <div class="shift-display">
                    <span class="timer-label">Shift</span>
                    <span id="shift-clock" class="shift-clock">05:00</span>
                </div>
                <div class="timer-controls">
                    <input id="set-min" type="number" class="time-input" value="5" pattern="\d*">
                    <button class="timer-btn" onclick="toggleShiftTimer()" id="timer-toggle">START</button>
                    <button class="timer-btn" onclick="resetShiftTimer()">↺</button>
                </div>
            </div>
        </div>

        <div id="pre-game-header">
            <h2 style="color:var(--primary); text-align:center; margin-bottom:4px;">Chargers C Team</h2>
            <p style="text-align:center; font-size:0.9em; color:#888; margin-bottom:20px;">Pick 5 Starters to Begin</p>
        </div>

        <div class="section-header header-court">ON COURT <span id="court-count" style="margin-left:8px; opacity:0.8;">0/5</span></div>
        <div id="court-list" class="player-list"></div>
        
        <div class="section-header header-bench" id="bench-header">BENCH</div>
        <div id="bench-list" class="player-list"></div>

        <div class="controls">
            <div id="msg" class="status-msg">Tap players to sub</div>
            <button id="confirm-btn" class="btn-confirm" onclick="confirmSubs()">SET ROSTER & RESET TIMER</button>
            <button id="start-game-btn" class="btn-start-game" onclick="startGame()">START GAME</button>
            <div class="btn-row">
                <button class="btn-secondary" onclick="undoSelection()" style="color:var(--pending)">Undo</button>
                <button class="btn-secondary" onclick="handleReset()" style="color:var(--error)">Reset</button>
            </div>
        </div>
    </div>

    <!-- STATS VIEW -->
    <div id="view-summary" class="container hidden">
        <h3 style="color:var(--primary); margin-bottom:10px;">Game Summary</h3>
        <p id="target-time-msg" style="font-size:0.8em; color:var(--confirm); margin-bottom:10px;"></p>
        <div id="summary-content" class="summary-box"></div>
        <button class="btn-secondary" onclick="copyStats()" style="margin-top:20px; width:100%; padding:15px;">Copy Stats to Clipboard</button>
    </div>

    <!-- HELP VIEW -->
    <div id="view-help" class="container hidden">
        <h3 style="color:var(--primary); margin-bottom:15px;">Quick Start Guide</h3>

        <div class="help-item">
            <span class="help-title">Colors & Indicators</span>
            <div class="legend-row">
                <div class="swatch" style="background:#261a00; border:2px solid var(--primary);"></div>
                <span><strong>Orange:</strong> Playing on court.</span>
            </div>
            <div class="legend-row">
                <div class="swatch" style="background:var(--card); border:2px solid var(--pending);"></div>
                <span><strong>Blue:</strong> Selected for next sub.</span>
            </div>
            <div class="legend-row">
                <div class="next-up-indicator" style="position:relative; display:inline-block; margin-right:16px;"></div>
                <span><strong>Green Dot:</strong> Suggested next sub (most rested).</span>
            </div>
        </div>

        <div class="help-item">
            <span class="help-title">Key Terms</span>
            <div class="help-text">
                • <strong>ROT:</strong> Number of times player entered the game.<br>
                • <strong>Sat:</strong> Minutes sitting on bench this current rest period.<br>
                • <strong>Shift:</strong> Countdown until next sub.<br>
                • <strong>Total:</strong> Overall game time elapsed.
            </div>
        </div>
        
        <div class="help-item">
            <span class="help-title">Mobile Tip</span>
            <div class="help-text">
                Set your phone's <strong>Auto-Lock</strong> to "Never" in settings for the best experience. The app will try to keep the screen awake, but system settings override it.
            </div>
        </div>
    </div>

<script>
    const NAMES = ["Adam", "Amara", "Avery", "Gregorio", "Jackson", "Jaxon", "Jayce", "Jodi", "Kainen", "Kenzo", "Luke", "Maddox", "Noah", "Pau", "Rafi", "Theo"];
    
    let players = NAMES.map((name, i) => ({ 
        id: i, name: name, onCourt: false, pendingStatus: false, totalSeconds: 0, shifts: 0, 
        available: true, secondsSat: 0 
    }));

    let shiftSecondsRemaining = 300;
    let shiftTimerRunning = false;
    let totalGameSeconds = 0;
    let gameStarted = false;
    let wakeLock = null;

    // Toast Logic
    function showToast(msg) {
        const toast = document.getElementById('toast');
        toast.innerText = msg;
        toast.style.opacity = '1';
        setTimeout(() => toast.style.opacity = '0', 2500);
    }

    // Wake Lock - Keep screen on
    async function requestWakeLock() {
        if ('wakeLock' in navigator) {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
            } catch (err) {
                console.log("WakeLock failed");
            }
        }
    }

    function switchTab(tab) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
        document.getElementById(`tab-${tab}`).classList.add('active');
        document.getElementById(`view-${tab}`).classList.remove('hidden');
        if (tab === 'summary') renderSummary();
        render();
    }

    function toggleShiftTimer() { 
        if (!gameStarted) return;
        const currentInGameCount = players.filter(p => p.onCourt).length;
        
        if (!shiftTimerRunning && currentInGameCount !== 5) {
            const msgArea = document.getElementById('msg');
            msgArea.innerText = `⚠️ NEED 5 ON COURT (Currently: ${currentInGameCount})`;
            msgArea.className = "status-msg text-error";
            return;
        }
        
        shiftTimerRunning = !shiftTimerRunning; 
        document.getElementById('timer-toggle').innerText = shiftTimerRunning ? "PAUSE" : "START"; 
        
        if (shiftTimerRunning) requestWakeLock();
        else if (wakeLock) { wakeLock.release(); wakeLock = null; }
        
        render();
    }

    function resetShiftTimer() { 
        shiftSecondsRemaining = document.getElementById('set-min').value * 60; 
        updateTimerDisplay(); 
    }

    function updateTimerDisplay() { 
        const clock = document.getElementById('shift-clock');
        const totalClock = document.getElementById('total-game-clock');
        clock.innerText = formatTime(Math.abs(shiftSecondsRemaining));
        totalClock.innerText = "TOTAL: " + formatTime(totalGameSeconds);
        shiftSecondsRemaining <= 0 ? clock.classList.add('expired') : clock.classList.remove('expired');
    }

    function startGame() {
        const pendingInCount = players.filter(p => p.pendingStatus && p.available).length;
        if (pendingInCount !== 5) return;

        players.forEach(p => {
            if (p.pendingStatus && p.available) {
                p.onCourt = true;
                p.shifts = 1;
            } else {
                p.onCourt = false;
                p.shifts = 0;
            }
            p.secondsSat = 0;
        });

        gameStarted = true;
        shiftTimerRunning = true; 
        requestWakeLock();
        showToast("Game Started!");
        render();
    }

    function render() {
        const rosterList = document.getElementById('roster-check-list');
        if (rosterList) {
            rosterList.innerHTML = '';
            players.forEach(p => {
                const div = document.createElement('div');
                div.className = `roster-card ${p.available ? 'present' : 'absent'}`;
                div.innerHTML = `<span>${p.name}</span><label class="switch"><input type="checkbox" ${p.available ? 'checked' : ''} onchange="toggleAvailability(${p.id})"><span class="slider"></span></label>`;
                rosterList.appendChild(div);
            });
        }

        const timerBox = document.getElementById('game-active-timer');
        const preGameHeader = document.getElementById('pre-game-header');
        const startGameBtn = document.getElementById('start-game-btn');
        const confirmBtn = document.getElementById('confirm-btn');
        const courtList = document.getElementById('court-list');
        const benchList = document.getElementById('bench-list');
        const timerToggleBtn = document.getElementById('timer-toggle');
        const msgArea = document.getElementById('msg');
        
        if (gameStarted) {
            timerBox.classList.remove('hidden');
            preGameHeader.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            confirmBtn.classList.remove('hidden');
            timerToggleBtn.innerText = shiftTimerRunning ? "PAUSE" : "START";
        } else {
            timerBox.classList.add('hidden');
            preGameHeader.classList.remove('hidden');
            startGameBtn.classList.remove('hidden');
            confirmBtn.classList.add('hidden');
        }

        courtList.innerHTML = ''; benchList.innerHTML = '';
        let currentInGameCount = 0;
        let pendingSelectionCount = 0;
        let changeDetected = false;

        players.forEach(p => {
            if (p.onCourt) currentInGameCount++;
            if (p.available && p.pendingStatus) pendingSelectionCount++;
            if (p.pendingStatus !== p.onCourt) changeDetected = true;
        });

        const displayBench = players.filter(p => p.available && !p.onCourt).sort((a, b) => {
            if (!gameStarted) return a.name.localeCompare(b.name);
            return (a.shifts - b.shifts) || (a.totalSeconds - b.totalSeconds);
        });

        players.filter(p => p.onCourt).forEach(p => createCard(p, courtList));
        displayBench.forEach((p, idx) => createCard(p, benchList, idx < 3));

        function createCard(p, container, isTopBench = false) {
            const card = document.createElement('div');
            const isPendingChange = p.pendingStatus !== p.onCourt;
            card.className = `player-card ${p.onCourt ? 'active' : ''} ${isPendingChange ? 'pending-change' : ''}`;
            card.onclick = () => { p.pendingStatus = !p.pendingStatus; render(); };
            
            // Add green "Ready" dot for top 3 bench players
            const indicator = (gameStarted && !p.onCourt && isTopBench) ? `<div class="next-up-indicator"></div>` : '';
            
            card.innerHTML = `
                ${indicator}
                <span class="name">${p.name}</span>
                <div class="time">${formatTime(p.totalSeconds)}</div>
                ${(!p.onCourt && gameStarted) ? `<div class="bench-timer">Sat: ${formatTime(p.secondsSat)}</div>` : ''}
                <div class="shift-badge ${p.shifts > 0 ? 'has-played' : ''}">ROT: ${p.shifts}</div>
            `;
            container.appendChild(card);
        }

        document.getElementById('court-count').innerText = `${gameStarted ? currentInGameCount : pendingSelectionCount}/5`;
        
        if (gameStarted) {
            confirmBtn.style.display = changeDetected ? 'block' : 'none';
            confirmBtn.disabled = pendingSelectionCount !== 5;
            if (changeDetected) {
                msgArea.innerText = pendingSelectionCount === 5 ? "Lineup Valid" : `Select 5 players (${pendingSelectionCount})`;
                msgArea.className = "status-msg " + (pendingSelectionCount === 5 ? "text-ok" : "text-error");
            } else {
                msgArea.innerText = "Tap players to sub";
                msgArea.className = "status-msg";
            }
        } else {
            startGameBtn.disabled = pendingSelectionCount !== 5;
            msgArea.innerText = pendingSelectionCount === 5 ? "Lineup ready!" : `Selected: ${pendingSelectionCount}/5`;
            msgArea.className = "status-msg " + (pendingSelectionCount === 5 ? "text-ok" : "text-error");
        }
    }

    function renderSummary() {
        const content = document.getElementById('summary-content');
        const targetMsg = document.getElementById('target-time-msg');
        content.innerHTML = '';
        const availableCount = players.filter(p => p.available).length;
        if (availableCount > 0) {
            const avgTime = Math.floor(totalGameSeconds * 5 / availableCount);
            targetMsg.innerText = `Fair Play Target: ${formatTime(avgTime)} per player`;
        }
        [...players].sort((a,b) => b.totalSeconds - a.totalSeconds).forEach(p => {
            const div = document.createElement('div');
            div.className = 'summary-row';
            div.innerHTML = `
                <span class="name" style="color:#fff; font-size:0.9em;">${p.name}</span>
                <div class="adj-group">
                    <button class="adj-btn" onclick="adjustTime(${p.id}, -60)">-1m</button>
                    <span class="stat-val">${formatTime(p.totalSeconds)}</span>
                    <button class="adj-btn" onclick="adjustTime(${p.id}, 60)">+1m</button>
                </div>
            `;
            content.appendChild(div);
        });
    }

    function adjustTime(id, delta) {
        const p = players.find(x => x.id === id);
        p.totalSeconds = Math.max(0, p.totalSeconds + delta);
        renderSummary(); render();
    }

    function copyStats() {
        let text = "Chargers C Team Stats:\n";
        [...players].sort((a,b) => b.totalSeconds - a.totalSeconds).forEach(p => {
            text += `${p.name}: ${formatTime(p.totalSeconds)} (${p.shifts} rotations)\n`;
        });
        const dummy = document.createElement("textarea");
        document.body.appendChild(dummy);
        dummy.value = text;
        dummy.select();
        document.execCommand("copy");
        document.body.removeChild(dummy);
        showToast("Stats Copied to Clipboard!");
    }

    function toggleAvailability(id) {
        const p = players.find(x => x.id === id); p.available = !p.available;
        if (!p.available && p.onCourt) { 
            p.onCourt = false; p.pendingStatus = false; p.secondsSat = 0;
        }
        render();
    }

    function confirmSubs() {
        players.forEach(p => {
            if (p.pendingStatus && !p.onCourt) { 
                p.onCourt = true; p.shifts++; 
                p.secondsSat = 0;
            } else if (!p.pendingStatus && p.onCourt) { 
                p.onCourt = false; p.secondsSat = 0; 
            }
        });
        resetShiftTimer(); 
        showToast("Substitutions Confirmed");
        render();
    }

    function undoSelection() { 
        players.forEach(p => p.pendingStatus = p.onCourt); 
        render(); 
    }

    function formatTime(sec) { const m = Math.floor(sec / 60); const s = sec % 60; return `${m}:${s.toString().padStart(2, '0')}`; }
    
    function handleReset() {
        // Safe reset: Check if confirming via custom logic
        if(confirm("Reset entire game? All stats will be lost.")) { 
            players.forEach(p => { 
                p.onCourt = false; 
                p.pendingStatus = false; 
                p.totalSeconds = 0; 
                p.shifts = 0; 
                p.secondsSat = 0; 
            }); 
            totalGameSeconds = 0; shiftTimerRunning = false; gameStarted = false; 
            if (wakeLock) { wakeLock.release(); wakeLock = null; }
            resetShiftTimer(); 
            showToast("Game Reset");
            render(); 
        } 
    }

    setInterval(() => { 
        if (shiftTimerRunning) { 
            shiftSecondsRemaining--; 
            totalGameSeconds++;
            players.forEach(p => { 
                if (p.available) {
                    if (p.onCourt) p.totalSeconds++;
                    else p.secondsSat++;
                }
            });
            updateTimerDisplay(); 
        } 
        render(); 
    }, 1000);
    
    render();
</script>
</body>
</html>
